---
name: soc-copilot
description: SOC子引擎，基于agent-skills技术通过AI赋能SOC平台，对SOC告警进行研判、调查、响应。SOC子引擎的核心理念为构建一个自我学习的安全引擎，可预测的告警通过规则匹配并通过脚本自动化处置，不可预测的告警通过大模型研判分析，分析完后生成规则和处置脚本，用户审核后固化到规则引擎，除此之外，用户可以主动输入SKILL对SOC子引擎进行训练。
argument-hint: "[告警日志目录路径]"
---

## 总体流程
1、从用户输入的路径获取该目录下的所有告警日志，对告警进行研判分析，对告警进行定性（定向攻击、自动化攻击、渗透测试、病毒木马、脆弱性风险、疑似攻击行为、业务行为）。
2、若需要进一步分析或溯源，则通过用户输入的API从SOC平台获取相关数据，然后对告警进行关联分析及攻击路径溯源。
3、最后通过用户输入的失陷主机登录方式（如SSH、RDP等），登录失陷主机，进行处置。
4、总结本次研判、调查、响应的经验，生成对应的研判规则(sigma格式)、溯源脚本（python格式）、响应脚本（bash格式/powershell格式），要求生成的规则和脚本尽可能地泛化，生成后用户可以手工编辑修改或反馈模型修改，最终用户审核后固化到规则引擎。
5、最终输出的分析报告保存为markdown文件，仅包含研判结论、研判思维链、调查结果、处置建议这几个章节。
6、用户可主动主动输入SKILL对SOC子引擎进行训练。

## 研判环节
1、从用户输入的路径获取该目录下的所有告警日志，解析用户输入的告警日志，根据告警日志中的告警名称、设备来源字段，快速判断属于哪种日志类型（network、endpoint）。
2、若为network日志类型，则提取告警名称、告警访问方向、数据包内容。告警日志里应该没有告警访问方向字段，但可以根据告警日志里的源IP和目的IP进行判断。数据包内容需要解析告警日志中的请求体、响应体、请求头、响应头进行拼接，如果拼接后的数据包经过编码，需要进行解码。
3、若为endpoint日志类型，则提取告警名称、进程链内容、文件内容。进程链需包含进程ID、进程文件路径、进程命令行、父进程ID、父进程文件路径、进程父进程命令行等信息，文件信息需包含文件路径、文件MD5、文件SHA256等信息。
4、根据告警名称判断该告警日志是属于哪种攻击类型，然后调用'{/rule-engine/triage-rules}'里对应的规则脚本进行规则匹配，若规则脚本匹配成功，则返回研判结论（定向攻击、自动化攻击、渗透测试、病毒木马、脆弱性风险、业务行为）和研判思维链。定向攻击指的是黑客真人攻击，自动化攻击指的是扫描器批量攻击，渗透测试指的内网漏扫行为（带有明显的test、vulscan等特征），病毒木马指的是僵木蠕勒索挖矿等低危告警，脆弱性风险指的是弱密码登录成功和未授权访问成功等告警，疑似攻击行为指的是无法分辨攻击还是业务的告警，业务行为指的是业务触发的误报。自动化攻击如果成功成功了，则改判为定向攻击。
5、若规则脚本未匹配中，则根据攻击类型调用'{/model-engine/triage}'里对应的经验进行研判，返回研判结论（定向攻击、自动化攻击、渗透测试、病毒木马、脆弱性风险、业务行为）和研判思维链。

## 调查环节
1、若研判环节未能对告警进行定性，则思考还需要哪些额外的数据（如告警相关的资产责任人、原始日志等）辅助分析，然后通过用户输入的API从SOC平台获取相关数据。如果该告警在同个主机近一段时间触发多次或在多个主机上均有出现，则该告警大概率为业务行为。如果该告警是突发性的或同时间段有其他可疑告警，则该告警大概率为定向攻击或自动化攻击。
2、若告警为渗透测试、脆弱性风险或业务行为，则无需关联分析及攻击路径溯源。
3、若告警为病毒木马，则调查失陷主机是否有横向移动行为，若有则调查横向移动路径，找到的其他所有潜在失陷主机。
4、若告警为自动化攻击，则调查对应主机这段时间的所有原始日志（通过API获取），分析是否有攻击成功的行为，若有则改判为定向攻击。
5、若告警为定向攻击，则调查对应主机这段时间的所有原始日志（通过API获取），向前溯源攻击的入口点，以及攻击者的后渗透行为。

## 响应环节
